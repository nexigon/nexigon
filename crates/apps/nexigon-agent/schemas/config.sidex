
/// Deployment token.
#[rust(type = "nexigon_ids::ids::DeploymentToken")]
#[json(type = "string")]
opaque DeploymentToken

/// Filesystem path.
#[rust(type = "std::path::PathBuf")]
#[json(type = "string")]
opaque PathBuf

/// Agent configuration.
#[json(rename_all = "kebab-case")]
record Config {
    /// URL of the Nexigon Hub server.
    hub_url: string,
    /// Deployment token.
    token: DeploymentToken,
    /// Fingerprint script.
    fingerprint_script: PathBuf,
    /// Path to the device certificate.
    ssl_cert?: PathBuf,
    /// Path to the device private key.
    ssl_key?: PathBuf,
    /// Disable TLS.
    dangerous_disable_tls?: bool,
    /// Exported services.
    exports?: [ExportConfig],
}

/// Service export configuration.
#[json(tag = "protocol", rename_all = "lowercase")]
variant ExportConfig {
    /// HTTP export configuration.
    Http: HttpExportConfig,
}

/// HTTP export configuration.
#[json(rename_all = "kebab-case")]
record HttpExportConfig {
    /// Name of the export.
    name: string,
    /// Port the service listens on.
    port: u16,
    /// URL path prefix for the service.
    path?: string,
}
